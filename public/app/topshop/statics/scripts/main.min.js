function isBody(a){return/^(?:body|html)$/i.test(a.tagName)}function getCompatElement(){var a=document;return a.compatMode&&"CSS1Compat"!=a.compatMode?a.body:a.html}document.head=document.head||document.getElementsByTagName("head")[0];function isElement(a){a=a[0]||a;return a.nodeName&&1===a.nodeType}function substitute(a,c){return String(a).replace(/\\?\{([^{}]+)\}/g,function(a,d){return"\\"===a.charAt(0)?a.slice(1):null!=c[d]?c[d]:""})}
function checkAll(a,c){$(c).prop("checked",$(a).prop("checked"))}$.fn.outerHtml=function(){if("outerHTML"in document.body){var a="";this.each(function(c){a+=this.outerHTML});return a}return $("<div>").append(this.clone(!0,!0)).html()};
$.fn.patch=function(a){var c=this,b;b=a?$.makeArray(a):["margin","padding","border"];var d={x:0,y:0};$.each({x:["left","right"],y:["top","bottom"]},function(a,k){$.each(k,function(k,h){try{$.each(b,function(b,g){g+="-"+h;0==g.indexOf("border")&&(g+="-width");d[a]+=parseInt(c.css(g))||0})}catch(m){}})});return d};
$.fn.locate=function(a){a=$.extend({relative:document.body,x:"center",y:"center"},a);var c=$(a.relative),b,d=$(this).css("position","absolute"),f=d.height();b=d.width();var k=(c.is("body")?$(window):c).innerHeight(),e=c.innerWidth();switch(a.x){case 0:case "left":b=0;break;case "right":b=e-b;break;default:b=parseInt((e-b)/2)}switch(a.y){case 0:case "top":a=0;break;case "bottom":a=k-f;break;default:a=parseInt((k-f)/2)}d.css({left:Math.max(0,Math.floor(b+(c.offset()?c.offset().left:0)+c.scrollLeft())),
top:Math.max(0,Math.floor(a+(c.offset()?c.offset().top:0)+c.scrollTop()))});return this};
var Class=function(a){var c=function(){"function"===typeof this.init&&this.init.apply(this,arguments)};c.prototype=a||{};c.prototype.setOptions=function(){this.options=$.extend.apply(null,[!0,{},this.options].concat($.makeArray(arguments)));return this};c.prototype.trigger=function(a,d){a=this.options[a]||this.options["on"+a.replace(/^[a-z]/g,function(a){return a.toUpperCase()})];"function"===typeof a&&a.apply(this,$.makeArray(d));return this};return c};
(function(){var a,c,b=window.console;window.log=a=function(){c.push(arguments);b?b.log[b.firebug?"apply":"call"](b,Array.prototype.slice.call(arguments)):alert(Array.prototype.slice.call(arguments).join("\n"))};a.history=c=[]})();var imageUpload=function(a){function c(){for(var a=$(".img-show a"),d=0;d<a.length;d++)for(var b=0;b<h.length;b++)h[b].img_id==$(a[d]).attr("href")&&$(a[d]).parent().parent().addClass("checked")}a=$.extend({url:"",target:document.body,fileName:"upload_files",inputName:"images[]",size:512E3,width:50,height:50,multiple:!0,isModal:!1,limit:0,handle:".action-upload",file_input:".action-file-input",insertWhere:null,callback:null},a||{});var b,d,f,k,e,h=[];$(a.target).on("click",a.handle,function(d){$(this).parent().find(a.file_input).click()}).on("change",
a.file_input,function(d){var b=$(this);d=b.parent();var c=d.find(a.handle),k=this.getAttribute("data-filename")||a.fileName,w=this.getAttribute("data-size"),w=Number(w)||a.size,e=d.find(this.getAttribute("data-insertwhere")||a.insertWhere||".image-box"),u=this.multiple,s=this.getAttribute("data-ismodal"),A=this.getAttribute("data-remote")||a.url,y=this.getAttribute("data-max")||a.limit,q=this.getAttribute("name")||a.inputName,l=this.getAttribute("data-callback")||b.data("callback")||a.callback,r=
new FormData,n=this.files;if(y&&d.find(".img-thumbnail:not(.action-upload)").length+(u&&n?n.length:1)>y)return alert("超出限制，最多上传"+y+"张。"),!1;if(!n||!Array.prototype.slice.call(n).every(function(a,d){if(a.size>w)return $("#messagebox").message('抱歉，上传图片 "'+a.name+'" 须小于'+w/1024+"kB!"),b.val(""),!1;u?r.append(k+"[]",a):r.append(k,a);return!0}))return!1;$.ajax({url:A,type:"POST",data:r,cache:!1,contentType:!1,processData:!1,success:function(a){try{a=JSON.parse(a)}catch(d){}if(a.success&&a.data){if(l)return l(a);
var m="";u?s?($("#areaselect_modal").modal("hide"),$(".nav-tabs .active").attr("data-type"),$(".has-searched")&&$(".has-searched").val(),$(".gallery-condition .active").hasClass("time")?($(".gallery-condition .active").attr("data-order"),$(".gallery-condition .active").attr("data-sort")):$(".gallery-condition .active").attr("data-order"),$.each(a.data,function(a,d){if(d.url){var b={};b.img_id=d.image_id;b.img_src=d.t_url;h.push(b);f&&"true"==f&&(m+='<div class="col-sm-3"><div class="thumbnail checked"><div class="img-show"><a href='+
d.url+'"><img src="'+d.t_url+'"></a></div><div class="caption" data-name="'+d.url+'" data-url="'+d.url+'"><p class="image-name">'+d.image_name+"</p></div></div></div>")}}),$(m).insertBefore($(".gallery > div:first-child"))):(e=c,$.each(a.data,function(a,d){d.url&&(m+='<div class="handle img-thumbnail"><i class="icon-close-b" onclick="$(this).parent().remove();"></i><img src="'+d.url+'"><input type="hidden" name="'+q+'" value="'+d.image_id+'"></div>')}),$(m).insertBefore(e)):(a=a.data[k],a.url&&(m=
'<img src="'+a.url+'"><input type="hidden" name="'+q+'" value="'+a.image_id+'">'),$(e).html(m))}else a.message&&($("#messagebox").message(a.message),b.val(""))},error:function(){$("#messagebox").message("上传出错，请重试")}})});$("#gallery_modal").on("shown.bs.modal",function(a){h=[];$(this);b=$(a.relatedTarget);d=b.attr("data-limit");f=b.attr("data-isMultiple");k=b.attr("data-name");b.parents(".multiple-upload").find(".multiple-item");e=b.parent().find(".multiple-item");$("#gallery_modal").attr("data-ids",
h);e&&($(e).each(function(a,d){var b={};b.img_id=$(d).find('input[name^="list"]').val();b.img_src=$(d).find("img").attr("src");h.push(b)}),c());$(this).on("click",".gallery-modal-tabs li a",function(a){a.preventDefault();$(".gallery-modal-tabs li").removeClass("active");$(this).parent().addClass("active");a=$(this).attr("href");$.post(a,function(a){$(".gallery-modal-content").empty().append(a);c()})})}).on("click",".action-save",function(){if(f&&"true"==f){for(var a="",c=0;c<h.length;c++)a+='<div class="multiple-item"><div class="multiple-del glyphicon glyphicon-remove-circle"></div><a class="select-image"><input type="hidden" name="'+
k+'" value="'+h[c].img_id+'"><div class="img-put"><img src="'+h[c].img_src+'"><i class="glyphicon glyphicon-picture"></i></div></a></div>';0==h.length?$("#messagebox").message("请选择图片!"):h.length>d?$("#messagebox").message("您选择得图片数量超出最大限制!"):(b.parents(".multiple-upload").find(".multiple-item").remove(),$("#gallery_modal").modal("hide"),b.before(a))}else{var a=$("#gallery_modal").find(".checked"),g=a.find("img").attr("src"),c=a.find(".caption").attr("data-name"),g='<img src="'+g+'">';0<a.length?(b.find(".img-put").empty().append(g),
b.find("input").val(c),$("#gallery_modal").modal("hide")):$("#messagebox").message("请选择图片!")}}).on("hide.bs.modal",function(a){$(this).removeData("bs.modal")}).on("click",".thumbnail",function(a){a.preventDefault();a={};a.img_id=$(this).find(".caption").attr("data-name");a.img_src=$(this).find(".caption").attr("data-url");if(f&&"true"==f)if($(this).toggleClass("checked"),$(this).hasClass("checked"))h.push(a);else for(var d=0;d<h.length;d++)h[d].img_id==a.img_id&&h.splice(d,1);else $(this).parent().siblings().find(".thumbnail").removeClass("checked"),
$(this).addClass("checked")}).on("click",".pagination a",function(a){a.preventDefault();$(this).parent().hasClass("disabled")||$.post($(this).attr("href"),function(a){setTimeout(function(){var a=$(".img-show a");if(e)for(var d=0;d<a.length;d++)for(var b=0;b<h.length;b++)h[b]==$(a[d]).attr("href")&&$(a[d]).parent().parent().addClass("checked")},100)})});$(".note-image-dialog").on("click",".action-save",function(){var a=$(".note-image-dialog").find(".checked");a.find("img").attr("src");0<a.length?$(".note-image-dialog").modal("hide"):
$("#messagebox").message("请选择图片!")}).on("click",".thumbnail",function(){$(this).parent().parent().find(".thumbnail").removeClass("checked");$(this).addClass("checked");var a=$(".note-image-dialog").find(".checked").find(".caption").attr("data-url");$(this).parents(".modal-body").find(".note-image-url").val(a)});$(".multiple-upload").on("click",".multiple-del",function(){$(this).parents(".multiple-upload").find(".multiple-add").show();$(this).parent().remove()})};jQuery(function(){imageUpload()});var left_side_width=220;
$(function(){function a(){var a=$(window).height()-($("body > .header").outerHeight()||0)-($("body > .footer").outerHeight()||0),b=$(".wrapper").height();$(".wrapper").css("min-height",a);$(".left-side, html, body").css("min-height",Math.max(b,a))}$("[data-toggle='offcanvas']").click(function(a){a.preventDefault();992>=$(window).width()?($(".row-offcanvas").toggleClass("active"),$(".left-side").removeClass("collapse-left"),$(".right-side").removeClass("strech"),$(".row-offcanvas").toggleClass("relative")):($(".left-side").toggleClass("collapse-left"),
$(".right-side").toggleClass("strech"))});$(".btn").bind("touchstart",function(){$(this).addClass("hover")}).bind("touchend",function(){$(this).removeClass("hover")});$("[data-toggle='tooltip']").tooltip();$("[data-widget='collapse']").click(function(){var a=$(this).parents(".box").first(),b=a.find(".box-body, .box-footer");a.hasClass("collapsed-box")?(a.removeClass("collapsed-box"),$(this).children(".fa-plus").removeClass("fa-plus").addClass("fa-minus"),b.slideDown()):(a.addClass("collapsed-box"),
$(this).children(".fa-minus").removeClass("fa-minus").addClass("fa-plus"),b.slideUp())});$(".navbar .menu").slimscroll({height:"200px",alwaysVisible:!1,size:"3px"}).css("width","100%");$('.btn-group[data-toggle="btn-toggle"]').each(function(){var a=$(this);$(this).find(".btn").click(function(b){a.find(".btn.active").removeClass("active");$(this).addClass("active");b.preventDefault()})});$("[data-widget='remove']").click(function(){$(this).parents(".box").first().slideUp()});$(".sidebar .treeview").tree();
a();$(window).resize(function(){a();fix_sidebar()});fix_sidebar();$("form:not([novalidate])").Validator({icons:{valid:"icon icon-checkmark-a",invalid:"icon icon-alert",validating:"icon icon-loading-c"}});$("body").on("click",".show-pics a",function(a){a.preventDefault();if(a=$(this).attr("href"))$("#show_img_madal").modal("show"),$("#big_img").attr("src",a);else return!1})});
function fix_sidebar(){$("body").hasClass("fixed")&&$(".sidebar").slimscroll({height:$(window).height()-$(".header").height()+"px",color:"rgba(0,0,0,0.2)"})}
(function(a){a.fn.boxRefresh=function(c){function b(a){a.append(f);d.onLoadStart.call(a)}var d=a.extend({trigger:".refresh-btn",source:"",onLoadStart:function(a){},onLoadDone:function(a){}},c),f=a('<div class="overlay"></div><div class="loading-img"></div>');return this.each(function(){if(""===d.source)console&&console.log("Please specify a source first - boxRefresh()");else{var c=a(this);c.find(d.trigger).first().click(function(a){a.preventDefault();b(c);c.find(".box-body").load(d.source,function(){c.find(f).remove();
d.onLoadDone.call(c)})})}})}})(jQuery);
(function(a){a.fn.tree=function(){return this.each(function(){var c=a(this).children("a").first(),b=a(this).children(".treeview-menu").first(),d=a(this).hasClass("active");d&&(b.show(),c.children(".fa-angle-left").first().removeClass("fa-angle-left").addClass("fa-angle-down"));c.click(function(a){a.preventDefault();d?(b.slideUp(),d=!1,c.children(".fa-angle-down").first().removeClass("fa-angle-down").addClass("fa-angle-left"),c.parent("li").removeClass("active")):(b.slideDown(),d=!0,c.children(".fa-angle-left").first().removeClass("fa-angle-left").addClass("fa-angle-down"),
c.parent("li").addClass("active"))});b.find("li > a").each(function(){var d=parseInt(a(this).css("margin-left"))+10;a(this).css({"margin-left":d+"px"})})})}})(jQuery);
(function(a){jQuery.fn.center=function(c){c=a.extend(!0,{},c);parent=c.parent?this.parent().css("position","relative"):window;this.css({top:"top"===c.top?0:c.top?c.top:(a(parent).height()-this.outerHeight())/2+a(parent).scrollTop()+"px",left:"left"===c.left?0:c.left?c.left:(a(parent).width()-this.outerWidth())/2+a(parent).scrollLeft()+"px"});return this}})(jQuery);
(function(a){a.fn.message=function(c,b,d,f){var k=this;this.data("timer")&&(clearTimeout(this.data("timer")),this.timer=null);this[0].className=this[0].className.replace(/alert-(success|error|warning|info|danger)/g,"");this.html(c).addClass("alert-"+(b||"error"));c=a("header.header").size()?a("header.header").height():"top";this.fadeIn("fast").center({top:c});this.data("timer",setTimeout(function(){k.fadeOut("fast");f&&f()},d||3E3))}})(jQuery);
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"object"===typeof exports?module.exports=a:a(jQuery)})(function(a){function c(a,b,c){var e="over"==b;a.addEventListener("OverflowEvent"in window?"overflowchanged":b+"flow",function(a){if(a.type==b+"flow"||0==a.orient&&a.horizontalOverflow==e||1==a.orient&&a.verticalOverflow==e||2==a.orient&&a.horizontalOverflow==e&&a.verticalOverflow==e)return a.flow=b,c.call(this,a)},!1)}function b(d){var b=d||window.event,c=[].slice.call(arguments,
1);d=a.event.fix(b);d.type="resize";c.unshift(d);return(a.event.dispatch||a.event.handle).apply(this,c)}a.event.special.resize={setup:function(){var a=this,f="onresize"in a;if(!f&&!a._resizeSensor){var k=a._resizeSensor=document.createElement("div");k.className="resize-sensor";k.innerHTML='<div class="resize-overflow"><div></div></div><div class="resize-underflow"><div></div></div>';var e=0,h=0,m=k.firstElementChild.firstChild,p=k.lastElementChild.firstChild,g=function(b){var c=!1,g=a.offsetWidth;
e!=g&&(m.style.width=g-1+"px",p.style.width=g+1+"px",c=!0,e=g);g=a.offsetHeight;h!=g&&(m.style.height=g-1+"px",p.style.height=g+1+"px",c=!0,h=g);if(c&&b.currentTarget!=a){b={};c=document.createEvent("Event");c.initEvent("resize","bubbles"in b?b.bubbles:!0,"cancelable"in b?b.cancelable:!0);for(var f in void 0)c[f]=(void 0)[f];a.dispatchEvent(c)}};"static"==getComputedStyle(a).position&&(a.style.position="relative",a._resizeSensor._resetPosition=!0);c(k,"over",g);c(k,"under",g);c(k.firstElementChild,
"over",g);c(k.lastElementChild,"under",g);a.appendChild(k);g({})}var v=a._flowEvents||(a._flowEvents=[]);-1==v.indexOf(b)&&v.push(b);f||a.addEventListener("resize",b,!1);a.onresize=function(b){v.forEach(function(c){c.call(a,b)})}},teardown:function(){var a=this._flowEvents.indexOf(b);-1<a&&this._flowEvents.splice(a,1);if(!this._flowEvents.length){if(a=this._resizeSensor)this.removeChild(a),a._resetPosition&&(this.style.position="static"),delete this._resizeSensor;"onresize"in this&&(this.onresize=
null);delete this._flowEvents}this.removeEventListener("resize",b)}};a.fn.extend({resize:function(a){return a?this.bind("resize",a):this.trigger("resize")},unresize:function(a){return this.unbind("resize",a)}})});
(function(a){jQuery.fn.extend({slimScroll:function(c){var b=a.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:0.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"0px",railBorderRadius:"0px"},c);this.each(function(){function d(d){if(p){d=d||
window.event;var c=0;d.wheelDelta&&(c=-d.wheelDelta/120);d.detail&&(c=d.detail/3);a(d.target||d.srcTarget||d.srcElement).closest("."+b.wrapperClass).is(l.parent())&&f(c,!0);d.preventDefault&&!q&&d.preventDefault();q||(d.returnValue=!1)}}function f(a,d,c){q=!1;var g=a,f=l.outerHeight()-n.outerHeight();d&&(g=parseInt(n.css("top"))+a*parseInt(b.wheelStep)/100*n.outerHeight(),g=Math.min(Math.max(g,0),f),g=0<a?Math.ceil(g):Math.floor(g),n.css({top:g+"px"}));s=parseInt(n.css("top"))/(l.outerHeight()-n.outerHeight());
g=s*(l[0].scrollHeight-l.outerHeight());c&&(g=a,a=g/l[0].scrollHeight*l.outerHeight(),a=Math.min(Math.max(a,0),f),n.css({top:a+"px"}));l.scrollTop(g);l.trigger("slimscrolling",~~g);h();m()}function k(){window.addEventListener?(this.addEventListener("DOMMouseScroll",d,!1),this.addEventListener("mousewheel",d,!1),this.addEventListener("MozMousePixelScroll",d,!1)):document.attachEvent("onmousewheel",d)}function e(){u=Math.max(l.outerHeight()/l[0].scrollHeight*l.outerHeight(),y);n.css({height:u+"px"});
var a=u==l.outerHeight()?"none":"block";n.css({display:a})}function h(){e();clearTimeout(w);s==~~s?(q=b.allowPageScroll,A!=s&&l.trigger("slimscroll",0==~~s?"top":"bottom")):q=!1;A=s;u>=l.outerHeight()?q=!0:(n.stop(!0,!0).fadeIn("fast"),b.railVisible&&x.stop(!0,!0).fadeIn("fast"))}function m(){b.alwaysVisible||(w=setTimeout(function(){b.disableFadeOut&&p||g||v||(n.fadeOut("slow"),x.fadeOut("slow"))},1E3))}var p,g,v,w,B,u,s,A,y=30,q=!1,l=a(this);if(l.parent().hasClass(b.wrapperClass)){var r=l.scrollTop(),
n=l.parent().find("."+b.barClass),x=l.parent().find("."+b.railClass);e();if(a.isPlainObject(c)){if("height"in c&&"auto"==c.height){l.parent().css("height","auto");l.css("height","auto");var z=l.parent().parent().height();l.parent().css("height",z);l.css("height",z)}if("scrollTo"in c)r=parseInt(b.scrollTo);else if("scrollBy"in c)r+=parseInt(b.scrollBy);else if("destroy"in c){n.remove();x.remove();l.unwrap();return}f(r,!1,!0)}}else b.height="auto"==b.height?l.parent().height():b.height,r=a("<div></div>").addClass(b.wrapperClass).css({position:"relative",
overflow:"hidden",width:b.width,height:b.height}),l.css({overflow:"hidden",width:b.width,height:b.height}),x=a("<div></div>").addClass(b.railClass).css({width:b.size,height:"100%",position:"absolute",top:0,display:b.alwaysVisible&&b.railVisible?"block":"none","border-radius":b.railBorderRadius,background:b.railColor,opacity:b.railOpacity,zIndex:90}),n=a("<div></div>").addClass(b.barClass).css({background:b.color,width:b.size,position:"absolute",top:0,opacity:b.opacity,display:b.alwaysVisible?"block":
"none","border-radius":b.borderRadius,BorderRadius:b.borderRadius,MozBorderRadius:b.borderRadius,WebkitBorderRadius:b.borderRadius,zIndex:99}),z="right"==b.position?{right:b.distance}:{left:b.distance},x.css(z),n.css(z),l.wrap(r),l.parent().append(n),l.parent().append(x),b.railDraggable&&n.bind("mousedown",function(b){var d=a(document);v=!0;t=parseFloat(n.css("top"));pageY=b.pageY;d.bind("mousemove.slimscroll",function(a){currTop=t+a.pageY-pageY;n.css("top",currTop);f(0,n.position().top,!1)});d.bind("mouseup.slimscroll",
function(a){v=!1;m();d.unbind(".slimscroll")});return!1}).bind("selectstart.slimscroll",function(a){a.stopPropagation();a.preventDefault();return!1}),x.hover(function(){h()},function(){m()}),n.hover(function(){g=!0},function(){g=!1}),l.hover(function(){p=!0;h();m()},function(){p=!1;m()}),l.bind("touchstart",function(a,d){a.originalEvent.touches.length&&(B=a.originalEvent.touches[0].pageY)}),l.bind("touchmove",function(a){q||a.originalEvent.preventDefault();a.originalEvent.touches.length&&(f((B-a.originalEvent.touches[0].pageY)/
b.touchScrollStep,!0),B=a.originalEvent.touches[0].pageY)}),e(),"bottom"===b.start?(n.css({top:l.outerHeight()-n.outerHeight()}),f(0,!0)):"top"!==b.start&&(f(a(b.start).position().top,null,!0),b.alwaysVisible||n.hide()),k()});return this}});jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);
(function(a){if(!window.localStorage||!window.JSON)return a.fn.rememberState=function(){return this};var c={name:"rememberState",clearOnSubmit:!0,ignore:null,use_ids:!1,mark:null,restoreState:function(a){var b=JSON.parse(localStorage.getItem(this.mark)),c=this.$el,e,h;for(h in b)e=c.find('[name="'+b[h].name+'"]'),e.is(":radio")?e.filter('[value="'+b[h].value+'"]').prop("checked",!0):e.is(":checkbox")&&b[h].value?e.prop("checked",!0):e.is("select")?e.find('[value="'+b[h].value+'"]').prop("selected",
!0):e.val(b[h].value),e.change();a&&a.preventDefault&&a.preventDefault()},saveState:function(d){d=d.data.instance;var c=d.$el.serializeArray();d.$el.find("input[type='datetime-local']").each(function(){var b=a(this);c.push({name:b.attr("name"),value:b.val()})});c=d.removeIgnored(c);c.length&&b.setObject(d.mark,c)},save:function(){var a=this;this.saveState||(a=this.data(c.name));a.saveState({data:{instance:a}})},removeIgnored:function(b){var c=this.ignore;if(!c)return b;a.each(b,function(k,e){-1!==
a.inArray(e.name,c)&&(b[k]=!1)});return b=a.grep(b,function(a){return a})},setName:function(){(this.mark=this.mark||this.$el.attr("id"))||console.warn("No form ID or other mark.");this.mark="rememberstate_"+this.mark},bindResetEvents:function(){var b=this;this.clearOnSubmit&&this.$el.bind("submit."+this.name,function(){a(this).trigger("reset_state");a(window).unbind("unload."+b.name)});this.$el.bind("reset_state."+this.name,function(){localStorage.removeItem(b.mark)});this.$el.find(":reset").bind("click."+
this.name,function(){a(this).closest("form").trigger("reset_state")})},destroy:function(b){var c="."+this.name;this.$el.unbind(c).find(":reset").unbind(c);a(window).unbind(c);b&&localStorage.removeItem(this.mark)},init:function(){this.setName();this.mark&&(this.bindResetEvents(),a(window).bind("unload."+this.name,{instance:this},this.saveState))}},b={setObject:function(a,b){localStorage[a]=JSON.stringify(b)},getObject:function(a){return JSON.parse(localStorage[a])},createPlugin:function(b){a.fn[b.name]=
function(c){var k=this,e=a.isPlainObject(c)||!c?"":c,h=arguments;e&&b[e]?k.each(function(a){b[e].apply(k.eq(a).data(b.name),Array.prototype.slice.call(h,1))}):e?a.error("Method "+e+" does not exist on jQuery."+b.name):k.each(function(e){var h=a.extend(!0,{$el:k.eq(e)},b,c);k.eq(e).data(b.name,h);h.init()});return k}}};b.createPlugin(c)})(jQuery);var goodsChoose=function(a){a=$.extend({url:"",getProUrl:"",getBrandUrl:"",getGoodsUrl:"",target:document.body,modalDom:"#goods_modal",handle:".select-goods",catBox:"#goods_category",catlistItem:"#goods_category li",catDefault:"分类",brandBox:"#goods_brand",brandList:"#brand_list",brandListItem:"#brand_list li",brandDefault:"品牌",filterBtn:"#search_goods",clearFilterBtn:"#clear_filter",clearBrandBtn:"#clear_brand",submitBtn:"#choose_goods",checkAll:"#check_all",uncheckAll:"#uncheck_all",goodsList:"#goods_list",
goodsListItem:"#goods_list > ul > li",goodsSearchKey:"#goods-search-key",goodsSearchBn:"#goods-search-bn",goodsSearchBrand:"#goods-search-brand",insertWhere:null,textcol:null,view:null,getPro:function(a,b,c,d,f,e,h,k){$.ajax({url:b,type:"POST",dataType:"html",data:{searchname:f,searchbn:e,searchbrand:h,catId:c,brandId:d},success:function(b){$(a).html(b);if(k)return k()}})}},a||{});var c,b,d,f=[],k=$(a.handle).attr("data-remote")||a.url,e=$(a.handle).attr("data-item_id"),h=$(a.handle).attr("data-fetchgoods")||
a.getGoodsUrl;insertWhere=$(a.insertWhere||".selected-goods-list");limit=$(a.handle).data("limit")||a.limit;var m=$(a.handle).data(),p;for(p in m)(p="remote")&&delete m[p],(p="fetchgoods")&&delete m[p],(p="target")&&delete m[p],(p="limit")&&delete m[p];$(a.target).on("click",a.handle,function(b){b.preventDefault();b=$(this).parents(".select-goods-panel");insertWhere=$(b).find(this.getAttribute("data-insertwhere")||a.insertWhere||".selected-goods-list");$(a.modalDom).modal("show")});$(function(){if(e&&
0<e.length)$.post(h,m,function(a){a&&$(insertWhere).html(a)});else return!1});$(a.modalDom).on("show.bs.modal",function(){f=[];var a=$(insertWhere).find("tr");$(a).each(function(a,b){f.push($(b).attr("date-itemid"))});$(this).find(".modal-content").load(k)}).on("shown.bs.modal",function(){c=$(a.filterBtn).attr("data-remote")||a.getProUrl;a.getPro(a.goodsList,c,"","","","","",function(){for(var b=$(a.goodsList).find("li"),c=0;c<b.length;c++)for(var d=$(b[c]).attr("data-id"),e=0;e<f.length;e++)d==f[e]&&
$(b[c]).addClass("checked")})}).on("hide.bs.modal",function(){a.getPro(a.goodsList,c)}).on("click",a.catlistItem,function(a){a.stopPropagation();a=$(this).attr("data-val");console.log($(this));a&&(b=$(this).attr("data-val"),a=$(this).children("span").text(),$(this).parents(".filters-list").hide().siblings(".filter-name").text(a))}).on("click",a.brandListItem,function(){d=$(this).attr("data-val");var a=$(this).text();$(this).parents(".filters-list").hide().siblings(".filter-name").text(a)}).on("click",
a.filterBtn,function(){var g=$(this).parent().find('input[name="item_title"]').val(),e=$(this).parent().find('input[name="item_bn"]').val(),h=$(this).parent().find('input[name="item_brand"]').val();a.getPro(a.goodsList,c,b,d,g,e,h,function(){for(var b=$(a.goodsList).find("li"),c=0;c<b.length;c++)for(var d=$(b[c]).attr("data-id"),g=0;g<f.length;g++)d==f[g]&&$(b[c]).addClass("checked")})}).on("click",a.goodsListItem,function(){$(this).toggleClass("checked");var b=$(this).data("id");if($(this).hasClass("checked")){if(limit){if("number"===
typeof limit&&0<parseInt(limit))limit=parseInt(limit);else return;if($(a.goodsList).find(".checked").length>limit){$("#messagebox").message("最多只能选择"+limit+"个商品");$(this).removeClass("checked");return}}f.push(b)}else for(var c=0;c<f.length;c++)f[c]==b&&f.splice(c,1)}).on("click",a.checkAll,function(){var b=$(a.goodsListItem),c=[];b.addClass("checked");for(var d=0;d<b.length;d++){var e=$(b[d]).data("id");c.push(e)}f=$.unique($.merge(f,c));console.log(f)}).on("click",a.uncheckAll,function(){var b=$(a.goodsListItem),
c=[];b.removeClass("checked");for(var d=f.concat(),e=0;e<b.length;e++){var h=$(b[e]).data("id");c.push(h)}for(e=0;e<d.length;e++)for(b=0;b<c.length;b++)if(d[e]==c[b]){f.splice(0,1);break}}).on("mouseover mouseout",a.catBox,function(a){var b=$(this).children(".filters-list");"mouseover"==a.type?b.show():"mouseout"==a.type&&b.hide()}).on("mouseover mouseout",a.brandBox,function(){var a=$(this).children(".filters-list");"mouseover"==event.type?a.show():"mouseout"==event.type&&a.hide()}).on("mouseover mouseout",
a.catlistItem,function(){var a=$(this).children(".child-list");$(a)&&("mouseover"==event.type?a.show():"mouseout"==event.type&&a.hide())}).on("click",a.clearFilterBtn,function(e){e.preventDefault();d=b=null;$(a.catBox).find(".filter-name").text(a.catDefault);$(a.brandBox).find(".filter-name").text(a.brandDefault);$(a.brandList).empty();$(a.goodsSearchKey).val("");$(a.goodsSearchBn).val("");$(a.goodsSearchBrand).val("");c=$(a.filterBtn).attr("data-remote")||a.getProUrl;a.getPro(a.goodsList,c,"","",
"","",function(){for(var b=$(a.goodsList).find("li"),c=0;c<b.length;c++)for(var d=$(b[c]).attr("data-id"),e=0;e<f.length;e++)d==f[e]&&$(b[c]).addClass("checked")})}).on("click",a.clearBrandBtn,function(b){b.preventDefault();d=null;$(a.brandBox).find(".filter-name").text(a.brandDefault)}).on("click",a.submitBtn,function(){0==f.length?$("#messagebox").message("请选择商品"):(m=$.extend(m,{item_id:f}),$.post(h,m,function(b){b?($(insertWhere).html(b),$(a.modalDom).modal("hide")):$("#messagebox").message("还未添加商品")}))}).on("click",
".pagination a",function(b){b.preventDefault();$(this).parent().hasClass("disabled")||$.post($(this).attr("href"),function(b){$(a.goodsList).html(b);b=$(a.goodsList).find("li");for(var c=0;c<b.length;c++)for(var d=$(b[c]).attr("data-id"),e=0;e<f.length;e++)d==f[e]&&$(b[c]).addClass("checked")})})};$(function(){goodsChoose()});